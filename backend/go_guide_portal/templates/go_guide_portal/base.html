<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Go&Guide</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            bg: '#0A192F',
            panel: '#112240',
            text: '#E6F1FF',
            muted: '#8892B0',
            accent: '#64FFDA',
            accent2: '#FE7B54',
          }
        }
      }
    }
  </script>
</head>
<body class="bg-bg text-text min-h-screen">
  {% with current_unit=unit %}
  <div class="bg-bg text-text min-h-screen">
    <!-- Mobile header -->
    <div class="md:hidden flex items-center justify-between px-4 py-3 border-b border-white/5">
      <div class="text-lg font-semibold">Go&Guide</div>
      <button id="sidebarToggle" class="p-2 rounded-md hover:bg-white/10 focus:outline-none" aria-label="Открыть меню">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>

    <div class="flex min-h-screen relative">
      <!-- Sidebar -->
      <aside id="sidebar" class="hidden md:flex fixed inset-y-0 left-0 w-64 bg-panel border-r border-white/5 transform -translate-x-full md:translate-x-0 transition-transform duration-200 ease-in-out z-50 flex-col">
        <div class="h-16 flex items-center px-6 text-xl font-semibold border-b border-white/5">
          Go&Guide
        </div>
        {% with active=request.resolver_match.url_name %}
        <nav class="flex-1 px-3 py-4 space-y-1 text-sm">
          {% if current_unit and current_unit.business_type == 'hotel' %}
            <a href="{% url 'go_guide_dashboard' %}" class="flex items-center px-3 py-2 rounded-md hover:bg-white/10 transition {% if active == 'go_guide_dashboard' %}bg-white/10 text-accent{% endif %}">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l9-8 9 8M4 10v10h6V14h4v6h6V10"/></svg>
              Главная
            </a>
            <a href="{% url 'rooms' %}" class="flex items-center px-3 py-2 rounded-md hover:bg-white/10 transition {% if active == 'rooms' %}bg-white/10 text-accent{% endif %}">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 10h16M4 14h16M10 6h4m-7 0h1m8 0h1M5 18h14"/></svg>
              Номера
            </a>
            <a href="{% url 'bookings' %}" class="flex items-center px-3 py-2 rounded-md hover:bg-white/10 transition {% if active == 'bookings' %}bg-white/10 text-accent{% endif %}">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V5a2 2 0 012-2h4a2 2 0 012 2v2m-8 0h8m-8 0H7a2 2 0 00-2 2v8a2 2 0 002 2h10a2 2 0 002-2V9a2 2 0 00-2-2h-1m-8 4h8m-8 4h5"/></svg>
              Бронирования
            </a>
            <a href="{% url 'analytics' %}" class="flex items-center px-3 py-2 rounded-md hover:bg-white/10 transition {% if active == 'analytics' %}bg-white/10 text-accent{% endif %}">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 19h16M7 16v-4m5 4V8m5 8V6"/></svg>
              Аналитика
            </a>
            <a href="{% url 'ai_assistant' %}" class="flex items-center px-3 py-2 rounded-md hover:bg-white/10 transition {% if active == 'ai_assistant' %}bg-white/10 text-accent{% endif %}">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6l4 2"/><circle cx="12" cy="12" r="9"/></svg>
              AI-ассистент
            </a>
            <a href="{% url 'settings' %}" class="flex items-center px-3 py-2 rounded-md hover:bg-white/10 transition {% if active == 'settings' %}bg-white/10 text-accent{% endif %}">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317l.675-1.842a1 1 0 011.9 0l.675 1.842a1 1 0 00.95.69h1.95a1 1 0 01.96 1.28l-.6 1.802a1 1 0 00.27 1.02l1.389 1.389a1 1 0 010 1.414l-1.389 1.389a1 1 0 00-.27 1.02l.6 1.802a1 1 0 01-.96 1.28h-1.95a1 1 0 00-.95.69l-.675 1.842a1 1 0 01-1.9 0l-.675-1.842a1 1 0 00-.95-.69h-1.95a1 1 0 01-.96-1.28l.6-1.802a1 1 0 00-.27-1.02L5.636 13.41a1 1 0 010-1.414l1.389-1.389a1 1 0 00.27-1.02l-.6-1.802A1 1 0 016.655 5h1.95a1 1 0 00.95-.683z"/><circle cx="12" cy="12" r="3"/></svg>
              Настройки
            </a>
          {% else %}
            <a href="{% url 'go_guide_dashboard' %}" class="flex items-center px-3 py-2 rounded-md hover:bg-white/10 transition {% if active == 'go_guide_dashboard' %}bg-white/10 text-accent{% endif %}">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l9-8 9 8M4 10v10h6V14h4v6h6V10"/></svg>
              Главная
            </a>
            <a href="{% url 'services' %}" class="flex items-center px-3 py-2 rounded-md hover:bg-white/10 transition {% if active == 'services' %}bg-white/10 text-accent{% endif %}">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 7h16M4 12h16M4 17h16"/></svg>
              Услуги
            </a>
            <a href="{% url 'appointments' %}" class="flex items-center px-3 py-2 rounded-md hover:bg-white/10 transition {% if active == 'appointments' %}bg-white/10 text-accent{% endif %}">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7V5a2 2 0 012-2h4a2 2 0 012 2v2m-8 0h8m-8 0H7a2 2 0 00-2 2v8a2 2 0 002 2h10a2 2 0 002-2V9a2 2 0 00-2-2h-1m-8 4h8m-8 4h5"/></svg>
              Записи
            </a>
            <a href="{% url 'analytics' %}" class="flex items-center px-3 py-2 rounded-md hover:bg-white/10 transition {% if active == 'analytics' %}bg-white/10 text-accent{% endif %}">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 19h16M7 16v-4m5 4V8m5 8V6"/></svg>
              Аналитика
            </a>
            <a href="{% url 'ai_assistant' %}" class="flex items-center px-3 py-2 rounded-md hover:bg-white/10 transition {% if active == 'ai_assistant' %}bg-white/10 text-accent{% endif %}">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6l4 2"/><circle cx="12" cy="12" r="9"/></svg>
              AI-ассистент
            </a>
            <a href="{% url 'settings' %}" class="flex items-center px-3 py-2 rounded-md hover:bg-white/10 transition {% if active == 'settings' %}bg-white/10 text-accent{% endif %}">
              <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317l.675-1.842a1 1 0 011.9 0l.675 1.842a1 1 0 00.95.69h1.95a1 1 0 01.96 1.28l-.6 1.802a1 1 0 00.27 1.02l1.389 1.389a1 1 0 010 1.414l-1.389 1.389a1 1 0 00-.27 1.02l.6 1.802a1 1 0 01-.96 1.28h-1.95a1 1 0 00-.95.69l-.675 1.842a1 1 0 01-1.9 0l-.675-1.842a1 1 0 00-.95-.69h-1.95a1 1 0 01-.96-1.28l.6-1.802a1 1 0 00-.27-1.02L5.636 13.41a1 1 0 010-1.414l1.389-1.389a1 1 0 00.27-1.02l-.6-1.802A1 1 0 016.655 5h1.95a1 1 0 00.95-.683z"/><circle cx="12" cy="12" r="3"/></svg>
              Настройки
            </a>
          {% endif %}
        </nav>
        {% endwith %}
        <div class="p-4 border-t border-white/5">
          <a href="{% url 'logout' %}" class="flex items-center px-3 py-2 rounded-md hover:bg-white/10 transition">
            <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M15 12H3m0 0l4-4m-4 4l4 4m4-10h5a2 2 0 012 2v8a2 2 0 01-2 2h-5"/></svg>
            Выйти
          </a>
        </div>
      </aside>

      <!-- Overlay for mobile -->
      <div id="sidebarOverlay" class="fixed inset-0 bg-black/40 z-20 hidden md:hidden"></div>

      <!-- Content -->
      <main class="flex-1 md:ml-64 pl-4 pr-6 py-6 w-full bg-gray-900 min-h-screen">
        {% if messages %}
          <div class="fixed top-4 right-4 space-y-3 z-40">
            {% for message in messages %}
              <div class="px-4 py-3 rounded-lg shadow-lg border border-white/10
                          {% if message.tags == 'error' %}bg-red-500/20 text-red-100
                          {% elif message.tags == 'success' %}bg-accent/20 text-accent
                          {% else %}bg-panel text-text{% endif %}">
                {{ message }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
        {% block content %}{% endblock %}
      </main>
    </div>
  </div>
  {% endwith %}

  <script>
    (function() {
      const toggle = document.getElementById('sidebarToggle');
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebarOverlay');

      if (!toggle || !sidebar) return;

      const openSidebar = () => {
        sidebar.classList.remove('hidden', '-translate-x-full');
        sidebar.classList.add('flex');
        if (overlay) overlay.classList.remove('hidden');
      };
      const closeSidebar = () => {
        sidebar.classList.add('-translate-x-full');
        sidebar.classList.remove('flex');
        sidebar.classList.add('hidden');
        if (overlay) overlay.classList.add('hidden');
      };

      toggle.addEventListener('click', () => {
        const isHidden = sidebar.classList.contains('hidden') || sidebar.classList.contains('-translate-x-full');
        if (isHidden) {
          openSidebar();
        } else {
          closeSidebar();
        }
      });

      if (overlay) {
        overlay.addEventListener('click', closeSidebar);
      }

      // Auto-hide toasts
      const toasts = document.querySelectorAll('.fixed.top-4.right-4 .rounded-lg');
      if (toasts.length) {
        setTimeout(() => {
          toasts.forEach(t => t.classList.add('opacity-0', 'transition', 'duration-300'));
          setTimeout(() => toasts.forEach(t => t.remove()), 400);
        }, 3500);
      }
    })();
  </script>
  {% block extra_js %}{% endblock %}
</body>
</html>